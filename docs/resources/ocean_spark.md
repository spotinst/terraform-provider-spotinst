---
layout: "spotinst"
page_title: "Spotinst: ocean_spark"
subcategory: "Ocean"
description: |-
  Provides a Spotinst Ocean Spark resource.
---

# spotinst\_ocean\_spark

Manages a Spotinst Ocean Spark resource on AWS or GCP.

## Prerequisites

An existing Ocean cluster is required by this resource. See e.g. the `spotinst_ocean_aws` resource.

## Example Usage

```hcl
provider "spotinst" {
  token   = "redacted"
  account = "redacted"
}

resource "spotinst_ocean_spark" "example" {
  ocean_cluster_id = "ocean-cluster-id"

  ingress {

    controller {
      managed = true
    }

    load_balancer {
      managed = true
      target_group_arn = "arn:aws:elasticloadbalancing:eu-north-1:XXXXXXXXXXXX:targetgroup/my-spark-cluster-nlb-tg/a38c2b83XXXXXXXX"
      service_annotations = {
        "service.beta.kubernetes.io/aws-load-balancer-security-groups": "sg-XXXXXXXXXXXXXXXXX"
        "some-service-annotation-2": "some-service-annotation-value-2"
      }
    }

    custom_endpoint {
      enabled = false
      address = "my-spark-cluster-nlb-8cbb8da7XXXXXXXX.elb.us-east-1.amazonaws.com"
    }

    private_link {
      enabled = false
      vpc_endpoint_service = "com.amazonaws.vpce.eu-north-1.vpce-svc-XXXXXXXXXXXXXXXXX"
    }

  }

  compute {
    create_vngs = true
    use_taints = true
  }

  log_collection {
    collect_app_logs = true
  }

  webhook {
    use_host_network = false
    host_network_ports = [25554]
  }

  spark {
    additional_app_namespaces = ["extra-spark-app-ns-1", "extra-spark-app-ns-2"]
  }
  
  workspaces {
    storage {
      defaults {
        storage_class_name = "my-custom-storage-class"
      }
    }
  }

}
```
```
output "ocean_spark_id" {
  value = spotinst_ocean_spark.example.id
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- **ocean_cluster_id** (String) - The ID of the Ocean cluster that Ocean for Apache Spark should be installed on.

### Optional

- **compute** (Block List, Max: 1) (see [below for nested schema](#nestedblock--compute))
- **ingress** (Block List, Max: 1) (see [below for nested schema](#nestedblock--ingress))
- **log_collection** (Block List, Max: 1) (see [below for nested schema](#nestedblock--log_collection))
- **webhook** (Block List, Max: 1) (see [below for nested schema](#nestedblock--webhook))
- **workspaces** (Block List, Max: 1) (see [below for nested schema](#nestedblock--workspaces))
- **spark** (Block List, Max: 1) (see [below for nested schema](#nestedblock--spark))

<a id="nestedblock--compute"></a>
### Nested Schema for `compute`

Optional:

- **create_vngs** (Boolean, default: `true`) - Enable/disable the creation of Ocean Spark VNGs during cluster creation.
- **use_taints** (Boolean, default: `true`) - Enable/disable Ocean Spark taints on the Ocean Spark VNGs. By default, Ocean Spark uses taints to prevent non-Spark workloads from running on Ocean Spark VNGs.


<a id="nestedblock--ingress"></a>
### Nested Schema for `ingress`

Optional:

- **controller** (Block List, Max: 1) (see [below for nested schema](#nestedblock--ingress--controller))
- **custom_endpoint** (Block List, Max: 1) (see [below for nested schema](#nestedblock--ingress--custom_endpoint))
- **load_balancer** (Block List, Max: 1) (see [below for nested schema](#nestedblock--ingress--load_balancer))
- **private_link** (Block List, Max: 1) (see [below for nested schema](#nestedblock--ingress--private_link))
- **service_annotations** (Map of String) - **DEPRECATED**: Use `load_balancer.service_annotations` instead.

<a id="nestedblock--ingress--controller"></a>
### Nested Schema for `ingress.controller`

Optional:

- **managed** (Boolean, default: `true`) - Should an ingress controller managed by Ocean for Apache Spark be installed on the cluster.


<a id="nestedblock--ingress--custom_endpoint"></a>
### Nested Schema for `ingress.custom_endpoint`

Optional:

- **address** (String) - The address the Ocean for Apache Spark control plane will use when addressing the cluster.
- **enabled** (Boolean, default: `false`) - Should the Ocean for Apache Spark control plane address the cluster using a custom endpoint. Use this to specify the DNS address of an externally provisioned (unmanaged) load balancer.


<a id="nestedblock--ingress--load_balancer"></a>
### Nested Schema for `ingress.load_balancer`

Optional:

- **managed** (Boolean, default: `true`) - Should a load balancer managed by Ocean for Apache Spark be provisioned for the cluster. Set this to false if you want to use an existing load balancer (only available on AWS).
- **service_annotations** (Map of String) - Annotations to add to the ingress controller load balancer service. This is useful to configure properties of the managed load balancer, like the nature of the load balancer (e.g. ELB, NLB, ALB on AWS), the security groups, or various timeouts.
- **target_group_arn** (String) - The ARN of a target group that the Ocean for Apache Spark ingress controller will be bound to. Set this to use an existing load balancer with Ocean for Apache Spark. Has no effect if using a managed load balancer. Only available on AWS.


<a id="nestedblock--ingress--private_link"></a>
### Nested Schema for `ingress.private_link`

Optional:

- **enabled** (Boolean, default: `false`) - Should the Ocean for Apache Spark control plane address the cluster via an AWS Private Link. Only available on AWS.
- **vpc_endpoint_service** (String) - The name of the VPC Endpoint Service the Ocean for Apache Spark control plane should bind to.



<a id="nestedblock--log_collection"></a>
### Nested Schema for `log_collection`

Optional:

- **collect_app_logs** (Boolean, default: `true`) - Enable/Disable collecting driver and executor logs. When enabled, logs are stored by NetApp and can be downloaded from the Spot console web interface. The logs are deleted after 30 days.


<a id="nestedblock--webhook"></a>
### Nested Schema for `webhook`

Optional:

- **host_network_ports** (List of Number) - List of ports allowed to use on the host network - if empty default is `25554`.
- **use_host_network** (Boolean, default: `false`) - Enable/disable host networking for the Spark Operator. Host networking can be useful when using custom CNI plugins like Calico on EKS.

<a id="nestedblock--spark"></a>
### Nested Schema for `spark`

Optional:

- **additional_app_namespaces** (List of String) - List of Kubernetes namespaces that should be configured to run Spark applications, in addition to the default Spark application namespace `spark-apps`. 

<a id="nestedblock--workspaces"></a>
### Nested Schema for `workspaces`

Optional:

- **storage** (Block List, Max: 1) (see [below for nested schema](#nestedblock--workspaces--storage))

<a id="nestedblock--workspaces--storage"></a>
### Nested Schema for `workspaces.storage`

Optional:

- **defaults** (Block List, Max: 1) (see [below for nested schema](#nestedblock--workspaces--storage--defaults))

<a id="nestedblock--workspaces--storage--defaults"></a>
### Nested Schema for `workspaces.storage.defaults`

Optional:

- **storage_class_name** (String) - The name of the default storage class to use for new workspaces. If not specified, the default storage class of the Kubernetes cluster will be used.
